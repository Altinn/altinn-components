import { Meta, Controls, Primary, Canvas } from "@storybook/addon-docs/blocks";
import * as LayoutStories from "./Layout.stories.tsx";
import * as HeaderStories from "../GlobalHeader/GlobalHeader.stories.tsx";
import * as FooterStories from "../Footer/Footer.stories.ts";

<Meta title="Layout" />

# Global Layout

The global layout is shared accross applications and provides a common `GlobalHeader` and `Footer`, as well as a container for a local `Menu`.

Use `Layout` by providing the `header` and `footer` props, and an optional `sidebar`. Layout must be wripped in an `RootProvider` to enable shared context across all components.
Provide the `RootProvider` with the current language of your application to make sure all internal texts of the Layout are set accordingly.
The Layout supports three languages: English (`en`), Norwegian Bokmål (`no`), and Norwegian Nynorsk (`nn`), where Norwegian Bokmål is the default

Add a `color` and a `theme` and include the content for your application as `children`.

```tsx
import { RootProvider, Layout } from '@altinn/components';

function App() {
  return (
    <RootProvider languageCode="nb">
      <Layout {...layoutProps} color={<Color>} theme={<Theme>}>
        { /* Your application here */ }
      </Layout>
    </RootProvider>
  );
}
```

## The Header

Use `header` to includes a header with global menu and search, as well as an account switcher when user is logged in.

<Canvas of={HeaderStories.LoggedIn} />

Prior to login, the global menu should include a prominent link to signing in.
The AccountSelector should automatically transform to a login button if `currentAccount` is undefined.
In this state, clicking the button will trigger the `onLoginClick` function provided to the header.

<Canvas of={HeaderStories.Login} />

The header handles opening and closing of its menus internally. However, the accountSelector can be forced open by setting the `forceOpenFullScreen` prop.
While this flag is set, the accountMenu will always remain open, and in its fullscreen mode.
Use this to force the user to select an account, for example if no valid account is chosen.

<Canvas of={HeaderStories.ForcedFullScreenAccountSelection} />

### The UseAccountMenu hook
To simplify the use of the new AccountSelector component, use the useAccountMenu.
This hook takes any needed data, such as the list of available actors and the list of favorites on the same data model as is expected from their respective API sources.
The hook handles all mapping, logic, and sorting nessesary for displaying the account list. Using this hook sentralizes logic and ensures a consistant view of the accountSelector across all products of the Altinn Portal.

Note that the accountData should be fetched from Access Management (which returns a list of authorizedParty objects), and the favorites should be fetched and updated in Core's profile API (which operates with a list of uuids).

```tsx
// Fetch data from different sources or APIs as needed (abstracted to hooks here for the example)
  const authorizedParties = getAuthorizedPartiesData(); // Fetch your authorized parties data from external source
  const [currentAccountUuid, setCurrentAccountUuid] = useCurrentAccount(); // Fetch current account from global state
  const selfAccountUuid = useCurrentAccount(); // Get the user's own account UUID from token or other source

  // Handler for toggling favorite accounts
  const onToggleFavorite = (uuid: string) => {
    setFavoriteUuids((prev) => (prev.includes(uuid) ? prev.filter((id) => id !== uuid) : [...prev, uuid]));
  };

  // Use the useAccountSelector hook to get account menu and loading state
  const accountSelector = useAccountSelector({
    partyListDTO: state === 'loggedIn' ? authorizedParties : [],
    favoriteAccountUuids: favoriteUuids,
    onToggleFavorite: onToggleFavorite,
    selfAccountUuid: state === 'loggedIn' ? selfAccountUuid : undefined,
    currentAccountUuid: state === 'loggedIn' ? currentAccountUuid : undefined,
    onSelectAccount: (accountId: string) => {
      setCurrentAccountUuid(accountId);
    },
    languageCode: languageCode,
    isLoading: state === 'loading',
  });

  <GlobalHeader accountSelector={accountSelector} globalMenu={globalMenu} globalSearch={{ onSearch }}  />
```

## The Footer

Use `footer` to includes an address and a list of helpful links.

<Canvas of={FooterStories.Default} />

## The Sidebar

Use `sidebar` to unclude an optional local menu. It can be hidden, or omitted completely. When omitted main content will span the full width of the page.

## Layout composition

While the preferred way of using layout is the `Layout` component itself, it is possible to build a layout using the underlying components.

```tsx
import { LayoutBase, GlobalHeader, LayoutBody, LayoutSidebar, Menu, LayoutContent, Footer } from "@altinn/altinn-components";

return (
  <LayoutBase>
    <GlobalHeader />
    <LayoutBody>
        <LayoutSidebar>
            <Menu />
        <LayoutContent>
            <!-- Your content -->
        </LayoutContent>
    </LayoutBody>
    <Footer />
  </LayoutBase>
);
```

## Preview

Layout with sidebar.

<Canvas of={LayoutStories.Preview} />

Layout with hidden sidebar.

<Canvas of={LayoutStories.HiddenSidebar} />
